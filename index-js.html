<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>animation</title>
    <style>
        body{
            padding: 1px;
            margin: 0px;
        }
        .container{
            position: relative;
            width: 550px;
            height: 400px;
            border-bottom: 1px solid #fff;
            margin:0px auto;
            overflow: hidden;
            background: #000030;
        }
    </style>
</head>
<body>
    <script src="http://g.tbcdn.cn/tbc/gama-gamekit/0.0.2/index-standalone-min.js"></script>
    <script src="http://g.tbcdn.cn/tmapp/hilo/1.0.0/standalone/hilo-standalone.min.js"></script>
    <script src="http://g.tbcdn.cn/tmapp/hilo/1.0.0/flash/hilo-flash.js" data-auto="true"></script>
    <script src="./src/anim-js.js"></script>
    <script src="./src/bridge/hiloBridge.js"></script>
    <script src="./src/bridge/gamaBridge.js"></script>
    <script>
        var GameKit = Gama.GameKit;
        var anims = [
            "anim0",
            "anim1",
            "anim2"
        ];
        
        var ticker = new Hilo.Ticker(60);
        ticker.addTick(Anim.js);
        ticker.start();

        anims.forEach(function(animName){
            startAnim(animName);
        });
 
        function startAnim(animName){
            var script = document.createElement("script");
            script.type = 'text/javascript';
            script.async = true;
            script.onload = function(){
                if(window[animName]){
                    init("./demo/" + animName + ".png", window[animName]);
                }
            };
            script.src = "./demo/" + animName + ".js";
            document.body.appendChild(script);
        }

        function init(image, data){
            var stageWidth = data.stage.width;
            var stageHeight = data.stage.height;
            var container = document.createElement("div");
            container.className = "container";
            container.style.width = stageWidth + "px";
            container.style.height = stageHeight + "px";
            document.body.appendChild(container);
                
            var stage, bridge;
            var useGama = location.search.indexOf("gama") > -1;
            if(useGama){
                stage = createGamaStage(container, stageWidth, stageHeight);
                bridge = Anim.gamaBridge;   
            }
            else{
                stage = createHiloStage(container, stageWidth, stageHeight);
                bridge = Anim.hiloBridge; 
            }
                     
            Anim.js.build({
                data:data,
                image:image,
                fps:24,
                container:stage
            }, bridge);
        }

        function createHiloStage(container, width, height){
            var stage = new Hilo.Stage({
                canvas:container,
                width:width,
                height:height
            });
            ticker.addTick(stage);
            return stage;
        }

        function createGamaStage(container, width, height){
            var stage = new GameKit.Stage({
                container: container,
                width:width,
                height:height,
            });
            stage.coverage.a = 0;
            var renderer = new GameKit.CanvasRenderer();

            ticker.addTick({
                tick:function(){
                    renderer.render(stage);
                }
            });
            return stage;
        }
    </script>
</body>
</html>